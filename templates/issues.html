<html>
    <head>
        <meta charset="utf-8" />
        <title>Issues</title>
        <style>
            body{
                background-image: url("/static/images/loginbg.jpg");
                background-repeat: no-repeat;
                background-size: cover;
                padding: 0;
                margin: 0;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }
            .menu{
                background-color: rgba(0,0,0,0.6);
                height: 100%;
                width: 15%;
                position: absolute;
            }
            h1{
                color: white;
                text-align: center;
            }
            .logout{
                height: 5%;
                position: absolute;
                left: 0;
                bottom: 0;
            }
            .settings{
                height: 5%;
                position: absolute;
                left: 83%;
                bottom: 0;
            }
            .issues{
                background-color: rgba(0,0,0,0.6);
                color: white;
                position: absolute;
                left: 17%;
                top: 2%;
                width: 81%;
                text-align: center;
            }
            form{
                visibility: hidden;
            }
        </style>
        <script>
            function onTableClick()
            {
                var row = document.getElementById("issuesTable").rows[0];
                row.onclick = (function (e)
                {
                    var index = 0;
                    var data = e.target;
                    while((data = data.previousElementSibling) != null )
                    {
                        index++;
                    }
                    document.getElementById("sortByField").value = row.cells[index].innerHTML;
                    switch(row.cells[index].innerHTML) {
                        case "ID":
                            document.getElementById("sortByField").value = "issues.id"
                            break;
                        case "Project":
                            document.getElementById("sortByField").value = "projects.name"
                            break;
                        case "Title":
                            document.getElementById("sortByField").value = "issues.title"
                            break;
                        case "Status":
                            document.getElementById("sortByField").value = "issues.status"
                            break;
                        case "Priority":
                            document.getElementById("sortByField").value = "issues.priority"
                            break;
                        case "Date Created":
                            document.getElementById("sortByField").value = "issues.date"
                            break;
                        case "Target Date":
                            document.getElementById("sortByField").value = "issues.target_date"
                            break;
                        case "Assigned To":
                            document.getElementById("sortByField").value = "E1.name"
                            break;
                        case "Created By":
                            document.getElementById("sortByField").value = "E2.name"
                            break;
                        default:
                            document.getElementById("sortByField").value = "issues.id"
                        }

                    document.sortForm.submit();
                });
            }
            
        </script>
    </head>
    <body>
    {% if session %}
        <div class = "menu">
            <h1>ISSUE TRACKER</h1>
            <a href = "/logout">
                <img class = "logout" src = "/static/images/logout.png" alt = "LOGOUT">
            </a>
            <a href = "/settings">
                <img class = "settings" src = "/static/images/settings.png" alt = "SETTINGS">
            </a>
        </div>
        <table class = "issues" id = "issuesTable" onclick="onTableClick()">
            <tr>
                <th>ID</th>
                <th>Project</th>
                <th>Title</th>
                <th>Status</th>
                <th>Priority</th>
                <th>Date Created</th>
                <th>Target Date</th>
                <th>Assigned To</th>
                <th>Created By</th>
            </tr>
        {% for row in data %}
            <tr>
                {% for cell in row %}
                    <td>{{ cell }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
        </table>
        <form action="{{ url_for('issues') }}" method="post" name = "sortForm">
            <input type="text" name="textField" id = "sortByField">
        </form>
    {% else %}
        Nah
    {% endif %}
    </body>
</html>